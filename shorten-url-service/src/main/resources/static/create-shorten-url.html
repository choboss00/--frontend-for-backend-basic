<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>단축 URL 생성</title>
    <link href="style.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>
<body>
<div class="nav-bar">
    <a href="/ui/create-shorten-url.html">단축 URL 생성</a>
    <a href="/ui/get-shorten-url-info.html">단축 URL 단건 정보 조회</a>
    <a href="/ui/get-shorten-url-info-list.html">단축 URL 전체 조회</a>
</div>
<form onsubmit="return createShortenUrl();">
    <input type="url" id="url-input" name="url" placeholder="Enter URL">
    <input type="submit">
</form>
<span id="created-shorten-url"><!-- 단축 url 생성된 코드가 들어감 --></span>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">

    function createShortenUrl() {
        const url = document.querySelector('#url-input').value;
        const requestObject = { originalUrl: url };

        fetch('/shortenUrl', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(requestObject)
        })
            .then(response => {
                if (response.status === 200) {
                    // response.json() body 에 있는 단축 url 키를 가져와야 함
                    // span 에 넣어주기
                    response.json().then(data => {
                        const shortenUrl = window.location.protocol + '//' + window.location.host + '/' + data.shortenUrlKey;
                        document.querySelector('#created-shorten-url').innerHTML = shortenUrl;
                    });
                    alert("단축 URL 이 생성되었습니다.");
                } else {
                    console.error('request failed');
                }
            })
            .catch(error => {
                console.error('request failed', error);
            });

        return false;
    }
</script>

</body>
</html>